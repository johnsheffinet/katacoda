# Deploy Containers Using Kubectl

# Step 1 - Launch Cluster
minikube version && \
minikube start

kubectl version --short && \
kubectl cluster-info

kubectl get cs,no

# Step 2 - Create Namespace
kubectl create ns bootcamp

kubectl get ns

# Step 3 - Create Deploy
kubectl create deploy kubernetes-bootcamp \
--image=gcr.io/google-samples/kubernetes-bootcamp:v1 \
--namespace=bootcamp

kubectl get deploy,po \
--namespace=bootcamp

# Step 4 - Expose Deploy
export SVC_PORT=8000 && \
echo $SVC_PORT

export POD_PORT=8080 && \
echo $POD_PORT

kubectl expose deploy/kubernetes-bootcamp \
--type=NodePort \
--port=$SVC_PORT \
--target-port=$POD_PORT \
--namespace=bootcamp

kubectl describe svc \
--namespace=bootcamp

export NODE_PORT=$(kubectl get svc --namespace=bootcamp --output=jsonpath='{.items[*].spec.ports[0].nodePort}') && \
echo $NODE_PORT

curl $(minikube ip):$NODE_PORT

export SVC_IP=$(kubectl get svc --namespace=bootcamp --output=jsonpath='{.items[*].spec.clusterIP}') && \
echo $SVC_IP

curl $SVC_IP:$SVC_PORT

export POD_IP=$(kubectl get po --namespace=bootcamp --output=jsonpath='{.items[*].status.podIP}') && \
echo $POD_IP

curl $POD_IP:$POD_PORT

# Step 5 - Scale Deploy
kubectl scale deploy/kubernetes-bootcamp \
--replicas=3 \
--namespace=bootcamp

kubectl get deploy \
--namespace=bootcamp

curl $(minikube ip):$NODE_PORT

# Step 5 - Create, Expose & Scale Deploy
kubectl run app \
--image=gcr.io/google-samples/kubernetes-bootcamp:v1 \
--replicas=3 \
--expose=true \
--port=$POD_PORT \
--service-overrides='{"apiVersion": "v1", "spec": {"type": "NodePort", "ports": [{"port": $SVC_PORT, "targetPort": $POD_PORT}]}}' \
--namespace=bootcamp

kubectl get deploy/app \
--namespace=bootcamp

kubectl describe svc/app \
--namespace=bootcamp

export APP_NODE_PORT=$(kubectl get svc/app --namespace=bootcamp --output=jsonpath='{.items[*].spec.ports[0].nodePort}') && \
echo $APP_NODE_PORT

curl $(minikube ip):$APP_NODE_PORT
