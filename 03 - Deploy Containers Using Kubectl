# Deploy Containers Using Kubectl

# Step 1 - Launch Cluster
minikube start

kubectl cluster-info

kubectl get cs

kubectl describe cs/scheduler

kubectl get no

kubectl describe no/minikube

export EXTERNAL_IP=$(kubectl cluster-info | grep KubeDNS | grep -oP "(\d{1,3}[\.]){3}\d{1,3}")

echo $EXTERNAL_IP

# Step 2 - Kubectl Run
kubectl run http \
--image=katacoda/docker-http-server:latest \
--replicas=1

kubectl get deploy

kubectl describe deploy http

kubectl get po

# Step 3 - Kubectl Expose
kubectl expose deploy http \
--external-ip=$EXTERNAL_IP \
--port=8000 \
--target-port=80

kubectl get svc

kubectl describe svc http

curl http://$EXTERNAL_IP:8000

# Step 4 - Kubectl Run and Expose
kubectl run httpexposed \
--image=katacoda/docker-http-server:latest \
--replicas=1 \
--port=80 \
--hostport=8001

kubectl get deploy

kubectl get po

kubectl get svc

docker ps | grep httpexposed

curl http://$EXTERNAL_IP:8001

# Step 5 - Scale Containers
kubectl scale deploy http \
--replicas=3

kubectl get deploy

kubectl get po

kubectl describe svc http

curl http://$EXTERNAL_IP:8000
